# 牛马生物钟 v1.2 (Desktop Visual Timer)

一个现代化、专业级的桌面闹钟和定时器应用，采用先进的UI设计系统，支持单次和重复性闹钟设置，具有系统托盘集成、跨平台通知系统、屏幕视觉效果和完善的设置系统。专为"牛马"们打造的生物钟管理工具！

## ✨ 功能特性

### 🔔 核心闹钟功能
- ✅ **精确到秒的闹钟**：支持时:分:秒级别的精确定时
- ✅ **单次闹钟**：设置指定时间的一次性闹钟，触发后自动删除
- ✅ **重复性闹钟**：按天为周期的重复闹钟（支持工作日、周末等自定义组合）
- ✅ **智能闹钟管理**：现代化ON/OFF切换按钮，一键启用/禁用
- ✅ **数据持久化**：所有闹钟设置自动保存，应用重启后保持
- ✅ **实时当前时间**：界面显示动态更新的当前时间

### 🚀 快捷倒计时器
- ✅ **番茄工作法**：一键启动25分钟专注计时（可自定义时长）
- ✅ **休息计时**：15分钟长休息、5分钟短休息（可自定义时长）
- ✅ **多计时器支持**：可同时运行多个倒计时器，独立管理
- ✅ **实时显示**：活跃计时器实时倒计时显示，精确到秒
- ✅ **一键取消**：随时取消正在运行的计时器
- ✅ **托盘快捷**：系统托盘右键菜单快速启动计时器

### 🖥️ 系统集成
- ✅ **系统托盘集成**：最小化到系统托盘，支持后台运行
- ✅ **托盘图标闪烁**：闹钟触发时托盘图标可视化提醒
- ✅ **左键快速操作**：左键点击托盘图标快速取消闹钟或显示窗口
- ✅ **智能通知系统**: 跨平台通知支持，使用notify-py库，自定义应用名称和图标
- ✅ **托盘快捷菜单**：右键菜单支持快捷计时和窗口控制

### 🖼️ 窗口跨屏移动功能 ⭐ NEW!
- ✅ **一键窗口移动**：按F9快速将当前窗口移动到下一个显示器
- ✅ **智能位置计算**：保持窗口相对位置和合适大小比例
- ✅ **最大化窗口支持**：完美处理最大化窗口的跨屏移动
- ✅ **多显示器兼容**：支持不同分辨率和DPI的显示器组合
- ✅ **可配置热键**：支持自定义快捷键组合（F1-F12，支持修饰键）
- ✅ **智能DPI检测**：自动检测显示器真实DPI和缩放比例
- ✅ **错误恢复机制**：即使API调用失败也能正确移动窗口

### 🎯 多重提醒方式
- ✅ **屏幕视觉效果**：边缘闪光或全屏闪烁提醒
- ✅ **提醒强度可调**：低/中/高三档强度设置
- ✅ **效果类型选择**：边缘闪光（不遮挡内容）或全屏闪烁
- ✅ **持续时间可调**：1-30秒自定义提醒持续时间
- ✅ **实时测试**：设置界面可立即测试视觉效果

### ⚙️ 完善的设置系统
- ✅ **通知设置**：控制系统通知开关，声音设置预留
- ✅ **界面设置**：托盘最小化、启动时最小化、开机自启动
- ✅ **计时器设置**：自定义番茄钟、长短休息时长
- ✅ **性能设置**：低功耗模式、检查间隔调整（0.1-5.0秒）
- ✅ **视觉效果设置**：效果类型、强度、持续时间完全可配置
- ✅ **设置持久化**：所有设置自动保存，重启后保持
- ✅ **一键重置**：恢复默认设置功能
- ✅ **窗口管理设置**：热键配置和特殊窗口处理选项

### 🎨 现代化UI设计
- ✅ **专业设计系统**：基于8px栅格系统的现代化界面
- ✅ **卡片式布局**：清晰的功能区域分离，阴影效果
- ✅ **统一视觉语言**：一致的颜色、字体和间距规范
- ✅ **响应式布局**：智能的空间分配和元素对齐
- ✅ **优雅交互**：点击编辑、悬停效果、现代化切换按钮
- ✅ **标签页设计**：设置界面采用标签页组织，清晰易用
- ✅ **中文本地化**：完整的中文界面和交互体验

### 🚀 性能优化
- ✅ **低功耗模式**：延长笔记本电池续航，自动调整检查间隔
- ✅ **资源占用优化**：最小化CPU和内存使用
- ✅ **后台运行**：系统托盘静默运行，不影响其他应用
- ✅ **智能检查间隔**：可调节定时器检查频率（0.1-5.0秒）
- ✅ **性能监控**：实时显示资源使用情况

## 🖥️ 系统要求

- **操作系统**：Windows 10/11（主要测试平台），Linux/macOS（兼容支持）
- **Python**：3.7 或更高版本
- **内存**：最低 50MB RAM（优化后通常使用30-40MB）
- **存储**：约 10MB 磁盘空间
- **CPU**：低功耗模式下CPU占用 < 1%

## 🚀 安装和运行

### 1. 克隆或下载项目
```bash
git clone <repository-url>
cd desktop-visual-timer
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

**主要依赖包括：**
- `tkinter` - GUI界面框架
- `notify-py` - 跨平台通知系统
- `pystray` - 系统托盘支持
- `pywin32` - Windows API支持（窗口管理功能）
- `pynput` - 全局热键监听
- `Pillow` - 图像处理

### 3. 运行应用
```bash
python src/main.py
```

**首次运行时会显示：**
- 显示器配置信息（分辨率、DPI、缩放比例）
- 窗口管理功能状态
- 热键配置信息（默认F9）

### 4. 首次使用
- 应用启动后会自动最小化到系统托盘
- 右键点击托盘图标可以显示主窗口或快速启动计时器
- 左键点击托盘图标可以快速取消闹钟或显示窗口
- 点击主界面右上角的 ⚙️ 按钮进入设置界面
- **按F9键可以将当前窗口移动到下一个显示器**

## 📖 使用指南

### 🔔 设置闹钟
1. **新建闹钟**：点击"+ 新建闹钟"按钮
2. **设置时间**：使用时:分:秒选择器设置精确时间
3. **添加标签**：为闹钟添加描述性名称
4. **选择重复**：勾选需要重复的星期几（不选则为单次闹钟）
5. **保存闹钟**：点击"保存"按钮完成设置

### ⏱️ 快捷计时器
- **主界面**：点击底部的番茄钟、休息按钮
- **托盘菜单**：右键托盘图标 → 快捷计时器 → 选择时长
- **自定义时长**：在设置中调整默认计时器时长

### ⚙️ 个性化设置
1. **通知设置**：控制系统通知开关
2. **界面设置**：托盘最小化、启动选项
3. **计时器设置**：自定义番茄钟和休息时长
4. **性能设置**：启用低功耗模式，调整检查间隔
5. **视觉效果**：配置屏幕提醒效果类型和强度

### 🎯 提醒效果
- **托盘闪烁**：图标在系统托盘闪烁
- **系统通知**：Windows原生通知弹窗
- **屏幕效果**：边缘闪光或全屏闪烁（可在设置中配置）

## 📦 依赖说明

- **pystray (0.19.0)**：跨平台系统托盘图标管理
- **schedule (1.2.0)**：高精度定时任务调度引擎
- **Pillow (10.0.0)**：图像处理（托盘图标渲染和界面图片显示）
- **notify-py**：跨平台通知系统，支持自定义应用名称和图标

## 项目结构

```
desktop-visual-timer/
├── src/                         # 源代码目录
│   ├── main.py                 # 应用程序入口点
│   ├── gui.py                  # 图形用户界面
│   ├── timer_engine.py         # 定时器引擎
│   ├── data_manager.py         # 数据管理
│   ├── tray_controller.py      # 系统托盘控制
│   ├── alarm_popup.py          # 弹窗通知组件
│   ├── settings_manager.py     # 设置管理
│   ├── settings_window.py      # 设置界面
│   ├── screen_effects.py       # 屏幕视觉效果
│   ├── window_manager.py       # 窗口跨屏移动功能 ⭐ NEW!
│   └── __init__.py
├── assets/                     # 资源文件
│   ├── icon_64.png            # 64x64 默认托盘图标
│   ├── icon_alert_64.png      # 64x64 闹钟提醒图标
│   └── notification.png       # 通知图标
├── docs/                       # 文档
│   ├── alarm_prd.md            # 产品需求文档 (闹钟相关prd)
│   ├── window_manager.md       # 窗口管理完整实现文档 ⭐ NEW!
│   └── issues.md               # 问题追踪文档 ⭐ NEW!
├── alarms.json                # 闹钟数据存储文件
├── settings.json              # 应用设置存储文件
├── requirements.txt           # Python依赖（包含pywin32, pynput）
├── debug-log.md              # 调试日志记录
├── 牛马生物钟.bat            # Windows启动脚本
└── README.md                 # 项目说明文档
```

## 📖 使用指南

### 🔔 创建和管理闹钟

#### 创建新闹钟
1. 点击左上角"+ 新建闹钟"按钮或直接在右侧面板操作
2. 设置精确时间（时:分:秒），界面显示当前时间作为参考
3. 输入闹钟标签（可选，默认为"催命小闹钟"）
4. 选择重复模式：
   - **单次闹钟**：不选择任何天数，触发后自动删除
   - **重复闹钟**：选择一个或多个天数（一二三四五六日）
5. 点击"保存"按钮完成创建

#### 管理现有闹钟
- **启用/禁用**：点击闹钟右侧的绿色"ON"或灰色"OFF"按钮
- **编辑闹钟**：点击闹钟卡片任意位置，在右侧面板修改后保存
- **删除闹钟**：点击闹钟右侧的"×"按钮

### ⏱️ 快捷倒计时器
- **🍅 专注 25分钟**：启动番茄工作法专注计时
- **🚶 休息 15分钟**：启动中等时长休息计时
- **☕ 休息 5分钟**：启动短暂休息计时
- **取消计时器**：在活跃计时器区域点击"×"按钮

### 🖱️ 系统托盘操作
- **左键单击**：
  - 闹钟闪烁时：立即取消闹钟
  - 正常状态时：显示/隐藏主窗口
- **右键单击**：显示快捷菜单
  - 显示/隐藏窗口
  - 快捷计时器子菜单
  - 退出应用
- **闹钟触发时**：
  - 托盘图标红蓝闪烁
  - 弹出Windows Toast通知
  - 左键点击或右键选择"Cancel Alarm"取消

## 🏗️ 架构设计

应用采用现代化模块化设计，主要组件包括：

### 核心模块
- **Application (main.py)**：应用程序主控制器，协调各组件生命周期
- **AppGUI (gui.py)**：基于专业UI设计系统的图形用户界面
- **TimerEngine (timer_engine.py)**：高精度定时器引擎，支持秒级调度
- **DataManager (data_manager.py)**：JSON文件数据持久化管理
- **TrayController (tray_controller.py)**：系统托盘集成和交互控制
- **AlarmPopup (alarm_popup.py)**：自定义弹窗通知组件

### 设计特点
- **模块化架构**：各组件职责清晰，低耦合高内聚
- **事件驱动**：基于回调机制的组件间通信
- **线程安全**：定时器和GUI在不同线程中安全运行
- **跨平台兼容**：核心功能支持Windows/Linux/macOS
- **可扩展性**：易于添加新功能和自定义选项

## 📊 开发状态

### ✅ 已完成功能（v1.0）
- **🔔 完整闹钟系统**：单次、重复、精确到秒的闹钟功能
- **⏱️ 快捷倒计时器**：番茄工作法、休息计时等预设功能
- **🖥️ 系统集成**：托盘图标、闪烁提醒、左键快速操作
- **📱 通知系统**：Windows Toast通知、跨平台兼容
- **💾 数据持久化**：可靠的JSON存储，支持应用重启
- **🎨 专业UI设计**：8px栅格系统、卡片式布局、现代化交互
- **🌐 中文本地化**：完整的中文界面和用户体验

### 🚀 技术亮点
- **秒级精度调度**：自研定时器引擎，突破schedule库限制
- **智能状态管理**：单次闹钟自动删除，重复闹钟保持
- **现代UI设计系统**：基于专业设计规范的界面架构
- **优雅的错误处理**：通知失败时的降级机制
- **高效的资源管理**：低CPU占用的后台运行

### 📈 性能指标
- **内存占用**：< 30MB（运行时）
- **CPU占用**：< 0.1%（待机时）
- **启动时间**：< 2秒
- **响应延迟**：< 100ms（界面操作）
- **定时精度**：±1秒（系统级精度）

## 🤝 贡献指南

我们欢迎各种形式的贡献来改进这个项目！

### 如何贡献
- **🐛 报告Bug**：通过GitHub Issues报告发现的问题
- **💡 功能建议**：提出新功能想法和改进建议
- **📝 代码贡献**：提交Pull Request来修复问题或添加功能
- **📖 文档改进**：帮助完善文档和使用指南
- **🌐 本地化**：协助翻译到其他语言

### 开发环境设置
```bash
# 克隆项目
git clone <repository-url>
cd desktop-visual-timer

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装开发依赖
pip install -r requirements.txt

# 运行测试
python src/main.py
```

## 📄 许可证

本项目采用 **MIT 许可证**。详情请参考 [LICENSE](LICENSE) 文件。

您可以自由地：
- ✅ 使用、复制、修改和分发本软件
- ✅ 用于商业和非商业目的
- ✅ 在遵循许可证条款的前提下进行任何操作

## 📞 联系方式

如有问题、建议或合作意向，请通过以下方式联系：

- **GitHub Issues**：[提交问题或建议](https://github.com/tataboxer/desktop-visual-timer/issues)
- **功能请求**：通过Issues标记为"enhancement"
- **Bug报告**：通过Issues标记为"bug"

## 🙏 致谢

感谢以下开源项目为本应用提供支持：
- [pystray](https://github.com/moses-palmer/pystray) - 系统托盘集成
- [schedule](https://github.com/dbader/schedule) - 定时任务调度
- [Pillow](https://github.com/python-pillow/Pillow) - 图像处理
- [pywin32](https://github.com/mhammond/pywin32) - Windows API支持
- [pynput](https://github.com/moses-palmer/pynput) - 全局热键监听

---

## 📋 版本历史

### v1.2.1 (当前版本)
- 🔧 **重要Bug修复**：解决repeat闹钟重启/休眠唤醒后不触发的问题
- 🔧 **配置文件修复**：修复settings.json语法错误，清理无用设置
- 🔧 **调度系统优化**：repeat闹钟改用second-level检查系统，提高可靠性
- 📚 **文档完善**：新增issue追踪文档，完善代码审查报告

### v1.2.0
- ✅ **新增自定义弹窗通知**：替代Toast通知，温和的淡蓝色设计
- ✅ **左右布局优化**：左侧大图标(128x128)，右侧文字信息
- ✅ **人性化交互**：非模态窗口，可稍后处理，30秒自动关闭
- ✅ **架构简化**：移除NotificationManager，直接使用弹窗组件
- ✅ **设置界面更新**："启用系统通知"改为"启用弹窗通知"

### v1.0.0
- ✅ 完整的闹钟和倒计时器功能
- ✅ 专业级UI设计系统
- ✅ 系统托盘集成和通知
- ✅ 中文本地化界面

**平台兼容性**：
- 🟢 **Windows 10/11**：完全支持，主要测试平台
- 🟡 **Linux**：基础功能支持，通知功能可能需要额外配置
- 🟡 **macOS**：基础功能支持，托盘行为可能略有差异

---

## 📚 文档

- [闹钟产品需求文档](docs/alarm_prd.md) - 详细的功能规格说明
- [窗口管理功能文档](docs/window_manager.md) - 跨屏窗口移动功能说明
- [问题追踪文档](docs/issues.md) - 已知问题与解决方案记录
- [代码审查报告](code_review_report.md) - 全面的代码质量分析

## 🔧 故障排除

### 常见问题

1. **程序无法启动**
   - 检查Python版本（需要3.7+）
   - 确认所有依赖已安装：`pip install -r requirements.txt`

2. **系统托盘图标不显示**
   - Windows：检查系统托盘设置
   - Linux：确保系统支持托盘图标

3. **闹钟不响**
   - 检查系统音量设置
   - 确认闹钟已启用（绿色开关）
   - **重要**：如果repeat闹钟重启后不触发，请查看[问题追踪文档](docs/issues.md#issue-001)

4. **窗口管理功能不工作**
   - 确保安装了pywin32：`pip install pywin32>=306`
   - 检查热键是否与其他软件冲突

### 获取帮助
- 查看[问题追踪文档](docs/issues.md)了解已知问题和解决方案
- 查看[代码审查报告](code_review_report.md)了解项目技术细节

---

**🎯 项目目标**：打造最优雅、最实用的桌面定时器应用，让时间管理变得简单而高效！